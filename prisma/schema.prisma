generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String?
  position      String?
  licenseNumber String?
  approved      Boolean  @default(false)
  onboardingCompleted Boolean @default(false)

  role   Role      @default(USER)
  orgId  String
  org    Organization @relation(fields: [orgId], references: [id])

  reports MedError[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Organization {
  id   String  @id @default(cuid())
  name String  @unique

  users User[]
}

enum Role {
  DEVELOPER
  ADMIN
  USER
}

model MedError {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  reportedById   String
  reportedBy     User     @relation(fields: [reportedById], references: [id])

  occurredAt     DateTime
  description    String
  severity       Severity
  errorType      ErrorType
  subErrorType   SubErrorType
  imageUrl       String?

  includeInDashboard Boolean @default(true)
}

enum Severity {
  A
  B
  C
  D
  E
  F
  G
  H
  I
}

enum ErrorType {
  PRESCRIBING
  TRANSCRIBING
  PRE_DISPENSING
  DISPENSING
  ADMINISTRATION
}

enum SubErrorType {
  WRONG_DOSE
  WRONG_DRUG
  WRONG_PATIENT
  WRONG_ROUTE
  DUPLICATE_ORDER
  OTHER
}
